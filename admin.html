<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Lucky Draw 관리자</title>
<style>
  :root{ --fg:#111; --muted:#777; --shadow:0 10px 30px rgba(0,0,0,.08); }
  body{
    margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Pretendard,Apple SD Gothic Neo,Malgun Gothic,Helvetica,Arial,"Noto Sans KR",sans-serif;
    color:var(--fg); background:#faf7f2;
  }
  .wrap{max-width:900px;margin:0 auto;padding:20px;}
  h1{font-size:20px;margin:0 0 14px;}
  .card{background:#fff; border:1px solid #eee; border-radius:16px; box-shadow:var(--shadow); padding:18px; margin-bottom:16px;}
  .grid{display:grid; grid-template-columns:1fr; gap:12px;}
  @media(min-width:780px){ .grid{grid-template-columns:1fr 1fr 1fr;} }
  .stack{display:grid; gap:6px;}
  input[type="text"], input[type="number"]{width:100%; padding:12px 12px; border:1px solid #e5e5e5; border-radius:12px; font-size:16px; background:#fff;}
  .help{font-size:12px;color:var(--muted);}
  .row{display:flex; align-items:center; justify-content:space-between; gap:10px;}
  .sum{font-size:13px;}
  .ok{color:#0f8d3a}.err{color:#c0342b}
  .actions{display:flex; gap:10px; flex-wrap:wrap;}
  button{appearance:none;border:none;border-radius:999px;padding:12px 18px;font-size:15px;font-weight:700;cursor:pointer;background:#111;color:#fff;}
  button.light{background:#f2f2f2;color:#111;}
  footer{font-size:12px;color:var(--muted);text-align:center;margin-top:8px;}
</style>
</head>
<body>
  <div class="wrap">
    <h1>Lucky Draw 관리자</h1>

    <div class="card">
      <div class="grid">
        <div class="stack">
          <label>1등 이름</label>
          <input id="name1" type="text" placeholder="1등 (예: 100ml 1개)" />
        </div>
        <div class="stack">
          <label>2등 이름</label>
          <input id="name2" type="text" placeholder="2등 (예: 20ml 1개)" />
        </div>
        <div class="stack">
          <label>3등 이름</label>
          <input id="name3" type="text" placeholder="3등 (예: 10% 쿠폰)" />
        </div>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div><strong>당첨 확률</strong> <span class="help">(합계 100%)</span></div>
        <div id="sum" class="sum">합계 100%</div>
      </div>
      <div class="grid">
        <div class="stack">
          <label>1등 (%)</label>
          <input id="p1" type="number" min="0" max="100" value="10" />
        </div>
        <div class="stack">
          <label>2등 (%)</label>
          <input id="p2" type="number" min="0" max="100" value="30" />
        </div>
        <div class="stack">
          <label>3등 (%)</label>
          <input id="p3" type="number" min="0" max="100" value="60" />
        </div>
      </div>
      <div class="help" style="margin-top:8px;">※ 0%도 가능. 단 합계는 100%여야 저장됩니다.</div>
    </div>

    <div class="card">
      <div class="grid" style="grid-template-columns:1fr 1fr;">
        <div class="stack">
          <label>시드(선택)</label>
          <input id="seed" type="text" placeholder="비워두면 매회 무작위" />
          <div class="help">같은 시드는 같은 결과 순서(테스트/검증용)</div>
        </div>
        <div class="stack">
          <label>빠른 테스트</label>
          <div class="actions">
            <button class="light" id="testBtn">테스트 추첨</button>
            <button class="light" id="resetBtn">기본값으로</button>
          </div>
        </div>
      </div>
      <div class="actions" style="margin-top:10px;">
        <button id="saveBtn">설정 저장</button>
      </div>
    </div>

    <!-- 참여 횟수 표시 / 초기화 -->
    <div class="card">
      <strong>참여 횟수</strong>
      <div id="countBox" style="margin-top:6px; font-size:18px; font-weight:bold;">0 회</div>
      <div class="actions" style="margin-top:10px;">
        <button id="resetCountBtn" class="light">카운트 초기화</button>
      </div>
      <div class="help" style="margin-top:6px;">※ 이 카운트는 이 기기(브라우저)에만 저장됩니다.</div>
    </div>

    <footer>설정은 이 브라우저의 저장소(localStorage)에 저장됩니다.</footer>
  </div>

<script>
(function(){
  const KEY='roulette_settings_v3';
  const $ = id => document.getElementById(id);
  const name1=$('name1'), name2=$('name2'), name3=$('name3');
  const p1=$('p1'), p2=$('p2'), p3=$('p3');
  const seed=$('seed');
  const sumEl=$('sum');
  const saveBtn=$('saveBtn'), resetBtn=$('resetBtn'), testBtn=$('testBtn');

  const countBox = $('countBox');
  const resetCountBtn = $('resetCountBtn');

  const defaults={names:["밀크티 미스트 100ml 1개","밀크티 미스트 20ml 1개","10% 할인 쿠폰"], pcts:[10,30,60], seed:""};

  function load(){
    try{
      const s = JSON.parse(localStorage.getItem(KEY)) || defaults;
      return { names:(s.names||defaults.names), pcts:(s.pcts||defaults.pcts), seed:(s.seed||"") };
    }catch(e){ return defaults; }
  }
  function fillUI(s){
    name1.value=s.names[0]||"1등";
    name2.value=s.names[1]||="2등";
    name3.value=s.names[2]||="3등";
    p1.value=s.pcts[0]??10;
    p2.value=s.pcts[1]??30;
    p3.value=s.pcts[2]??60;
    seed.value=s.seed||"";
    updateSum();
  }
  function updateSum(){
    const a=toInt(p1.value), b=toInt(p2.value), c=toInt(p3.value), S=a+b+c;
    sumEl.textContent=`합계 ${S}%`;
    sumEl.className = 'sum ' + (S===100?'ok':'err');
  }
  function toInt(v){ v=parseInt(v,10); return isNaN(v)?0:Math.max(0,Math.min(100,v)); }
  [p1,p2,p3].forEach(inp=> inp.addEventListener('input', updateSum));

  saveBtn.addEventListener('click', ()=>{
    const S = toInt(p1.value)+toInt(p2.value)+toInt(p3.value);
    if(S!==100){ alert('확률 합계가 100%가 아닙니다.'); return; }
    const data = {
      names: [name1.value.trim()||"1등", name2.value.trim()||"2등", name3.value.trim()||"3등"],
      pcts:  [toInt(p1.value), toInt(p2.value), toInt(p3.value)],
      seed:  seed.value.trim()
    };
    localStorage.setItem(KEY, JSON.stringify(data));
    alert('저장했습니다. 참여자 화면을 새로고침하면 반영됩니다.');
  });

  resetBtn.addEventListener('click', ()=> fillUI(defaults));

  testBtn.addEventListener('click', ()=>{
    const a=toInt(p1.value), b=toInt(p2.value), c=toInt(p3.value), S=a+b+c;
    if(S!==100){ alert('합계 100%로 맞춰주세요.'); return; }
    const r = Math.random();
    const th1=a/100, th2=(a+b)/100;
    const grade = (r<th1)?'1등':(r<th2?'2등':'3등');
    alert(`테스트 결과 등수: ${grade}`);
  });

  /* 참여 횟수 표시/초기화 */
  function loadCount(){
    const c = parseInt(localStorage.getItem('roulette_count') || '0', 10);
    countBox.textContent = `${c} 회`;
  }
  resetCountBtn.addEventListener('click', ()=>{
    localStorage.setItem('roulette_count', '0');
    loadCount();
  });

  fillUI(load());
  loadCount();
})();
</script>
</body>
</html>